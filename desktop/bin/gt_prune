#!/bin/bash
#List old QA/STG remote tags. older than 2 months
git for-each-ref --sort=taggerdate --format '%(refname:short) %(taggerdate:short)' refs/tags | egrep "(-rc|-beta)" | egrep -v "($(date +%Y-%m)|$(date -d "-1 month" +%Y-%m)|$(date -d "-2 month" +%Y-%m))"

if [ "purge" == "$1" ]; then

  #delete old tags
  git for-each-ref --sort=taggerdate --format '%(refname:short) %(taggerdate:short)' refs/tags | egrep "(-rc|-beta)" | egrep -v "($(date +%Y-%m)|$(date -d "-1 month" +%Y-%m)|$(date -d "-2 month" +%Y-%m))" | awk '{print $1}' | xargs -n 1 git push --no-verify --delete origin
fi
