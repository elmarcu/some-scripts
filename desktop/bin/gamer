#!/bin/sh
SESSION="gamer"
SESSIONEXISTS=$(tmux list-sessions | grep $SESSION)

GAMER_MIN_SPEED=600MHz
GAMER_MAX_SPEED=800MHz
GAMER_GOVERNOR=powersave

case "$1" in
  help)
    echo "[empty] will change cpu throttle to gamer settings\n[custom min max] will change cpu throttle to custom settings to min max user params\n[stop] restores cpu throttle"
    exit 0
  ;;
  stop)
    if [ "$SESSIONEXISTS" != "" ]; then
      tmux kill-session -t $SESSION
    fi
    cpu
  ;;
  *)
    if [ "$SESSIONEXISTS" = "" ]; then

      if [ "$1" = "custom" ]; then
        if [ ! -z $2 ]; then
          GAMER_MIN_SPEED=$2
        fi

        if [ ! -z $3 ]; then
          GAMER_MAX_SPEED=$3
        fi
      fi

      tmux new-session -d -s $SESSION 'watch -n 5 sensors $(sensors | grep core)' \; \
        split-window -v -p 85 'htop' \; \
        split-window -v -p 25 'bash' \; \
        select-pane -t 0 \; \
        split-window -h -p 55 'watch -n 5 -c "cpufreq-info -c 0 | grep -A3 current\ policy"' \; \
        split-window -h "watch cpu $GAMER_GOVERNOR $GAMER_MIN_SPEED $GAMER_MAX_SPEED" \; \
        select-pane -t 4 \;
    fi
    tmux attach-session -t $SESSION:0
  ;;
esac
